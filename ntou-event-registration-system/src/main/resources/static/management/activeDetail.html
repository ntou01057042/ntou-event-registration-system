<!DOCTYPE html>
<html lang="en">
<head>
    <script src="http://code.jquery.com/jquery-1.10.2.js"></script>
    <script src="http://code.jquery.com/ui/1.11.2/jquery-ui.js"></script>
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"
            integrity="sha256-xLD7nhI62fcsEZK2/v8LsBcb4lG7dgULkuXoXB/j91c=" crossorigin="anonymous"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
    <meta charset="UTF-8">
    <title>詳細資訊</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <link href="activeDetail.css" rel="stylesheet" type="text/css">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <style>
        a {
            text-decoration: none;
            text-align: center;
        }

        .remaining-space {
            height: calc(1024px - 56px);
        }

        * {
            font-family: "微軟正黑體";
        }
    </style>
    <script>
        window.addEventListener("load", function () {
            loading();
        });
        let id;

        function loading() {
            id = localStorage.getItem("eventID");
            $.ajax({
                url: "/events/" + id,
                type: "GET",
                success: function (data) {
                    console.log(data);
                    campaign(data);
                }
            })

            $.getJSON("../file/categories.json", function (data) {
                let selectElement = document.getElementById("classFrom");
                for (let category in data) {
                    if (data.hasOwnProperty(category)) {
                        data[category].forEach(function (unit) {
                            let button = document.createElement("button");
                            button.className = "btn";
                            button.textContent = unit;
                            button.addEventListener("click", function () {
                                let buttonText = $(this).text();
                                console.log(unit);
                                filterCampaignsByCategory(unit);
                            });
                            selectElement.appendChild(button);
                        });
                    }
                }
            });
            document.getElementById("sign_up").addEventListener('click', () => {
                localStorage.removeItem('eventID');
                localStorage.setItem('eventID', id);
                window.location.assign('signUpPage.html',);
            });

            document.getElementById("commentForm").addEventListener("submit", function (event) {
                event.preventDefault();
                const formData = new FormData(event.target);
                const obj = Object.fromEntries(formData.entries());

                $.ajax({
                    contentType: "application/json",
                    data: obj["comment"],
                    success: function () {
                        console.log("成功：" + JSON.stringify(obj));
                        loadComment();
                    },
                    type: "PUT",
                    url: "/events/" + id
                });
            });

            loadComment();
        }

        function campaign(data) {
            let detail = document.getElementById("info");
            let startTime = new Date(data.startTime);
            let endTime = new Date(data.endTime);
            const options = {
                weekday: "long",
                year: "numeric",
                month: "long",
                day: "numeric",
                hour: "2-digit",
                minute: "2-digit"
            };
            detail.innerHTML = `
                   <div class="text-center card">
                       <h3 class="m-3">${data.title}</h3>
                       <h4 class="m-3">${startTime.toLocaleString(undefined, options)}</h4>
                       <h4 class="m-3">${endTime.toLocaleString(undefined, options)}</h4>
                       <p class="m-3">${data.describe}</p>
                       <p class="m-3">${data.venue}</p>
                   </div>

            `;


        }


        function loadComment() {
            $.ajax({
                url: "/events/" + id,
                type: "GET",
                success: function (data) {
                    console.log(data);
                    let commentArea = document.getElementById("comments");
                    commentArea.innerHTML = "";
                    for (let i = 0; i < data["comments"].length; ++i) {

                        console.log(commentArea);
                        commentArea.innerHTML += `
                            <div class="card mt-3 commentArea">
                                <div class="card-body">
                                    <img src="../img/user_circle.png" alt="circle" class="userCircle me-3">
                                    ${data["comments"][i]}
                                </div>
                            </div>
                        `
                    }
                }
            })

        }


    </script>
</head>
<body>
<!-- Navbar -->
<div class="container-fluid p-0 m-0">
    <nav class="navbar navbar-expand-lg bg-light shadow-sm px-3">

        <div>
            <a class="navbar-brand" href="../homepage.html"><img src="../img/badge-check.png" alt="" width="30"
                                                                 height="30" class="d-inline-block align-text-top">&nbsp海大活動報名系統</a>
        </div>
        <div class="d-flex">
            <form class="me-2">
                <input class="form-control" type="search" placeholder="搜尋活動" aria-label="Search" id="search-bar">
            </form>

            <button class="btn btn-outline-success" type="button" id="search-button">搜尋</button>
        </div>

        <div class="nav-item ms-auto">
            <a class="nav-link dropdown-toggle" href="../main%20page/advancedUser.html" role="button" id="member">
                <img src="../img/user.png" class="rounded-circle" height="25" alt="member" loading="lazy"/>
            </a>
        </div>
    </nav>
    <div class="container-fluid">
        <div class="row remaining-space">
            <div class="space col-0 col-lg-1 d-none d-lg-block">

            </div>
            <div class="d-flex flex-column col-3 col-lg-2 shadow manu">
                <hr>
                <a href="#" class="d-flex  justify-content-center  link-dark text-decoration-none">
                    <span class="fs-4">所有活動</span>
                </a>
                <hr>
                <ul class="nav nav-pills flex-column mb-auto " id="classFrom">
                    <li class="nav-item">
                        <a href="#" class="nav-link">
                            首頁
                        </a>
                    </li>
                </ul>
                <hr>
            </div>
            <div class="p-3 m-0 col-9 col-sm-8 col-xl-7" id="details">
                <div class="gx-3 row">

                    <div class="col-md-10">
                        <div id="info">
                            a
                        </div>
                        <div class="card mt-3">
                            <form id="commentForm" class="card-body">
                                <div class="mb-3">
                                    <label for="comment" class="form-label"></label>
                                    <textarea class="form-control" name="comment" id="comment" rows="3"
                                              placeholder="輸入留言..." required></textarea>
                                </div>
                                <div class="text-center" >
                                    <button type="submit" class="btn btn-primary" id="mybtn">送出留言</button>
                                </div>
                            </form>
                        </div>
                        <h5 class="mt-3 text-center">留言區</h5>
                        <div id="comments"></div>
                        <div>
                        </div>
                        <div class="space col-0 col-sm-1  d-none d-sm-block">

                        </div>
                    </div>
                    <div class="col-md-2 remaining-space">
                        <button type="button" class="btn btn-primary" id="sign_up"
                                style="">立即報名
                        </button>
                    </div>
                </div>
            </div>

            <div class="space col-0 col-sm-1  d-none d-sm-block">
            </div>


        </div>

</body>
</html>